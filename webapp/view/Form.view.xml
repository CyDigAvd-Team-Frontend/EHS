<mvc:View
    controllerName="no.mil.zehs.controller.Form"
    xmlns:f="sap.ui.layout.form"
    xmlns:layout="sap.ui.layout"
    xmlns:unified="sap.ui.unified"
    xmlns:common="sap.ui.commons"
    xmlns:mvc="sap.ui.core.mvc"
    displayBlock="true"
    xmlns:core="sap.ui.core"
    xmlns="sap.m"
>
    <Page
        id="page"
        title="{i18n>createIncident}"
        showFooter="true"
        showNavButton="true"
        navButtonPress="handleClose"
    >
        <content>
            <VBox
                class="sapUiResponsiveMargin"
                renderType="Div"
            >
                <f:SimpleForm
                    id="SimpleFormChange471"
                    editable="true"
                    layout="ResponsiveGridLayout"
                    labelSpanXL="4"
                    labelSpanL="4"
                    labelSpanM="4"
                    labelSpanS="12"
                    adjustLabelSpan="false"
                    emptySpanXL="1"
                    emptySpanL="2"
                    emptySpanM="2"
                    emptySpanS="0"
                    columnsXL="1"
                    columnsL="1"
                    columnsM="1"
                    singleContainerFullSize="false"
                    class="sapUiResponsiveMargin"
                >
                    <f:content>
                        <Toolbar
                            style="Clear"
                            design="Solid"
                            ariaLabelledBy="titleHeader,butGDPR"
                            class="sapUiLargeMarginBottom borderBottom sapUiLargeMarginEnd"
                        >
                            <Title
                                id="titleHeader"
                                text="{i18n>InformationTitle}"
                                class="sapUiSmallMarginBottom"
                            />
                            <ToolbarSpacer />
                            <Link
                                href="{i18n>LinkToDataPrivacy}"
                                id="butGDPR"
                                text="{i18n>LinkToDataPrivacyText}"
                                target="_blank"
                                class="sapUiSmallMarginBottom"
                            />
                            <ToolbarSpacer width="0%" />
                        </Toolbar>
                        <!-- Header for Section: Information -->
                        <!-- Title -->
                        <Label
                            id="labelTitle"
                            labelFor="inputTitle"
                            fieldGroupIds="incidentHeader,requiresValidation"
                            text="{i18n>Title}"
                            required="true"
                        />
                        <Input
                            id="inputTitle"
                            fieldGroupIds="incidentHeader"
                            value="{Title}"
                            maxLength="80"
                        >
                            <!-- <layoutData>
									<layout:GridData span="XL7 L7 M7 S12"/>
								</layoutData> -->
                        </Input>
                        <!-- What do you want to register_ -->
                        <Label
                            labelFor="inputIsCriticalRel"
                            text="Si fra om kritikkverdig forhold (varsle)?"
                        />
                        <Switch
                            id="inputIsCriticalRel"
                            state="{initModel>/bIsCriticalRel}"
                            customTextOn="{i18n>Yes}"
                            customTextOff="{i18n>No}"
                        >
                            <layoutData>
                                <layout:GridData span="XL6 L6 M6 S11" />
                            </layoutData>
                        </Switch>
                        <Button
                            type="Transparent"
                            icon="sap-icon://sys-help-2"
                            text="{i18n>Help}"
                            press="onBtnHintPressed"
                            ariaLabelledBy="defaultHint"
                            ariaDescribedBy="defaultHint"
                        >
                            <layoutData>
                                <layout:GridData span="XL1 L1 M1 S1" />
                            </layoutData>
                        </Button>
                        <!-- Si fra om personskade? -->
                        <Label
                            labelFor="inputIsPersonWound"
                            text="Si fra om personskade?"
                        />
                        <Switch
                            id="inputIsPersonWound"
                            state="{initModel>/bIsPersonWound}"
                            customTextOn="{i18n>Yes}"
                            customTextOff="{i18n>No}"
                        >
                            <layoutData>
                                <layout:GridData span="XL6 L6 M6 S11" />
                            </layoutData>
                        </Switch>
                        <Button
                            type="Transparent"
                            icon="sap-icon://sys-help-2"
                            text="{i18n>Help}"
                            press="onBtnHintPressed"
                            ariaLabelledBy="defaultHint"
                            ariaDescribedBy="defaultHint"
                        >
                            <layoutData>
                                <layout:GridData span="XL1 L1 M1 S1" />
                            </layoutData>
                        </Button>
                        <!-- Si fra om skade på miljø eller eiendom? -->
                        <Label
                            labelFor="inputIsMateriel"
                            text="Si fra om skade på miljø eller eiendom?"
                        />
                        <Switch
                            id="inputIsMateriel"
                            state="{initModel>/bIsEnvironmentEstate}"
                            customTextOn="{i18n>Yes}"
                            customTextOff="{i18n>No}"
                        >
                            <layoutData>
                                <layout:GridData span="XL6 L6 M6 S11" />
                            </layoutData>
                        </Switch>
                        <Button
                            type="Transparent"
                            icon="sap-icon://sys-help-2"
                            text="{i18n>Help}"
                            press="onBtnHintPressed"
                            ariaLabelledBy="defaultHint"
                            ariaDescribedBy="defaultHint"
                        >
                            <layoutData>
                                <layout:GridData span="XL1 L1 M1 S1" />
                            </layoutData>
                        </Button>
                        <!-- Si fra om skade på  materiell
 -->
                        <Label
                            labelFor="inputIsEnvironmentEstate"
                            text="Si fra om skade på  materiell?"
                        />
                        <Switch
                            id="inputIsEnvironmentEstate"
                            state="{initModel>/bIsMateriel}"
                            customTextOn="{i18n>Yes}"
                            customTextOff="{i18n>No}"
                        >
                            <layoutData>
                                <layout:GridData span="XL6 L6 M6 S11" />
                            </layoutData>
                        </Switch>
                        <Button
                            type="Transparent"
                            icon="sap-icon://sys-help-2"
                            text="{i18n>Help}"
                            press="onBtnHintPressed"
                            ariaLabelledBy="defaultHint"
                            ariaDescribedBy="defaultHint"
                        >
                            <layoutData>
                                <layout:GridData span="XL1 L1 M1 S1" />
                            </layoutData>
                        </Button>

                        <!-- Si fra om nestenulykke? -->
                        <Label
                            labelFor="inputIsAllmostAccident"
                            text="Si fra om nestenulykke?"
                        />
                        <Switch
                            id="inputIsAllmostAccident"
                            state="{initModel>/bIsAllmostAccident}"
                            customTextOn="{i18n>Yes}"
                            customTextOff="{i18n>No}"
                        >
                            <layoutData>
                                <layout:GridData span="XL6 L6 M6 S11" />
                            </layoutData>
                        </Switch>
                        <Button
                            type="Transparent"
                            icon="sap-icon://sys-help-2"
                            text="{i18n>Help}"
                            press="onBtnHintPressed"
                            ariaLabelledBy="defaultHint"
                            ariaDescribedBy="defaultHint"
                        >
                            <layoutData>
                                <layout:GridData span="XL1 L1 M1 S1" />
                            </layoutData>
                        </Button>
                        <!-- Description of Events -->
                        <Label
                            id="labelDescription"
                            labelFor="inputDescription"
                            fieldGroupIds="incidentHeader,requiresValidation"
                            text="{i18n>DescriptionOfEvents}"
                            required="true"
                        />
                        <TextArea
                            id="inputDescription"
                            fieldGroupIds="incidentHeader"
                            value="{DescText}"
                            growingMaxLines="30"
                            rows="6"
                            cols="50"
                            growing="true"
                            width="100%"
                            placeholder="{i18n>DescriptionOfEventsHelpDescription}"
                        >
                            <layoutData>
                                <layout:GridData span="XL6 L6 M6 S11" />
                            </layoutData>
                        </TextArea>
                        <Button
                            type="Transparent"
                            icon="sap-icon://sys-help-2"
                            text="{i18n>Help}"
                            press="onBtnHintPressed"
                            ariaLabelledBy="defaultHint"
                            ariaDescribedBy="defaultHint"
                        >
                            <layoutData>
                                <layout:GridData span="XL1 L1 M1 S1" />
                            </layoutData>
                            <customData>
                                <!-- Custom Data which controls the texts and element the popover help shall be displayed for -->
                                <core:CustomData
                                    key="elmentIdForPopoverHelp"
                                    value="inputDescription"
                                />
                                <core:CustomData
                                    key="i18nAliasForHintHeader"
                                    value="DescriptionOfEventsHelpTitle"
                                />
                                <core:CustomData
                                    key="i18nAliasForHintTextHtml"
                                    value="DescriptionOfEventsHelpHtml"
                                />
                            </customData>
                        </Button>
                        <core:InvisibleText
                            id="defaultHint"
                            text="{i18n>Help}"
                        />
                        <!-- Strakstiltak  -->
                        <Label
                            id="labelImDesc"
                            labelFor="inputImDesc"
                            fieldGroupIds="incidentHeader,requiresValidation"
                            text="{i18n>ImDescOfEvents}"
                            required="false"
                        />
                        <TextArea
                            id="inputImDesc"
                            fieldGroupIds="incidentHeader"
                            value="{DescText}"
                            growingMaxLines="30"
                            rows="2"
                            cols="50"
                            growing="true"
                            width="100%"
                            placeholder=""
                        >
                            <layoutData>
                                <layout:GridData span="XL6 L6 M6 S11" />
                            </layoutData>
                        </TextArea>
                        <Button
                            type="Transparent"
                            icon="sap-icon://sys-help-2"
                            text="{i18n>Help}"
                            press="onBtnHintPressed"
                            ariaLabelledBy="defaultHint"
                            ariaDescribedBy="defaultHint"
                        >
                            <layoutData>
                                <layout:GridData span="XL1 L1 M1 S1" />
                            </layoutData>
                            <customData>
                                <!-- Custom Data which controls the texts and element the popover help shall be displayed for -->
                                <core:CustomData
                                    key="elmentIdForPopoverHelp"
                                    value="inputDescription"
                                />
                                <core:CustomData
                                    key="i18nAliasForHintHeader"
                                    value="DescriptionOfEventsHelpTitle"
                                />
                                <core:CustomData
                                    key="i18nAliasForHintTextHtml"
                                    value="DescriptionOfEventsHelpHtml"
                                />
                            </customData>
                        </Button>
                        <core:InvisibleText
                            id="defaultHintImd"
                            text="{i18n>Help}"
                        />
                        <!-- ENd Strakstiltak  -->
                        <!-- When did it happen ? -->
                        <Label
                            id="labelDateOrPeriod"
                            labelFor="inputDateOrPeriod"
                            text="{i18n>DateOrPeriod}"
                            required="true"
                        />

                        <!-- Date -->
                        <VBox>
                            <DatePicker
                                id="inputDate"
                                fieldGroupIds="incidentHeader"
                                value="{ path: 'StartDate', type: 'sap.ui.model.type.Date', formatOptions: { strictParsing: true, UTC: true } }"
                                visible="{= ${initModel>/sDateOrPeriod} === 'date' ? true : false }"
                            />
                            <DateRangeSelection
                                id="inputPeriod"
                                fieldGroupIds="incidentHeader"
                                dateValue="{ path: 'StartDate', formatOptions: { strictParsing: true, UTC: false } }"
                                secondDateValue="{ path: 'EndDate', formatOptions: { strictParsing: true, UTC: false } }"
                                visible="{= ${initModel>/sDateOrPeriod} === 'period' ? true : false }"
                            />
                        </VBox>
                        <Button
                            type="Ghost"
                            icon="sap-icon://fob-watch"
                            text="{i18n>Today}"
                            press="onBtnTodayPressed"
                            ariaLabelledBy="defaultHint"
                            ariaDescribedBy="defaultHint"
                        >
                            <layoutData>
                                <layout:GridData span="XL1 L1 M1 S1" />
                            </layoutData>
                            <customData>
                                <!-- Custom Data which controls the texts and element the popover help shall be displayed for -->
                                <core:CustomData
                                    key="elmentIdForPopoverHelp"
                                    value="inputDescription"
                                />
                                <core:CustomData
                                    key="i18nAliasForHintHeader"
                                    value="DescriptionOfEventsHelpTitle"
                                />
                                <core:CustomData
                                    key="i18nAliasForHintTextHtml"
                                    value="DescriptionOfEventsHelpHtml"
                                />
                            </customData>
                        </Button>
                        <SegmentedButton
                            id="inputDateOrPeriod"
                            width="100%"
                            selectedKey="{initModel>/sDateOrPeriod}"
                        >
                            <items>
                                <SegmentedButtonItem
                                    text="{i18n>Date}"
                                    key="date"
                                />
                                <SegmentedButtonItem
                                    text="{i18n>Period}"
                                    key="period"
                                />
                            </items>
                            <layoutData>
                                <layout:GridData span="XL2 L2 M2 S12" />
                            </layoutData>
                            <customData>
                                <!-- Custom Data which controls the texts and element the popover help shall be displayed for -->
                                <core:CustomData
                                    key="elmentIdForPopoverHelp"
                                    value="inputDescription"
                                />
                                <core:CustomData
                                    key="i18nAliasForHintHeader"
                                    value="DescriptionOfEventsHelpTitle"
                                />
                                <core:CustomData
                                    key="i18nAliasForHintTextHtml"
                                    value="DescriptionOfEventsHelpHtml"
                                />
                            </customData>
                        </SegmentedButton>

                        <!-- On behalf of: No/Yes -->
                        <Label
                            id="labelIsOnBehalfOf"
                            labelFor="inputIsOnBehalfOf"
                            text="{i18n>OnBehalfOf}"
                        />
                        <Switch
                            id="inputIsOnBehalfOf"
                            state="{initModel>/bIsOnBehalfOf}"
                            customTextOn="{i18n>Yes}"
                            customTextOff="{i18n>No}"
                        />

                        <Label
                            id="labelIsInvolved"
                            labelFor="inputIsInvolved"
                            text="{i18n>OnInvolved}"
                        />
                        <Switch
                            id="inputIsInvolved"
                            state="{initModel>/bIsInvolved}"
                            customTextOn="{i18n>Yes}"
                            customTextOff="{i18n>No}"
                        />

                        <Toolbar
                            style="Clear"
                            design="Solid"
                            ariaLabelledBy="titleLocation,butGDPR"
                            class="sapUiLargeMarginBottom borderBottom sapUiLargeMarginEnd"
                            visible="{initModel>/bIsOnBehalfOf}"
                        >
                            <Title
                                id="titleLocation"
                                text="{i18n>OnBehalfOfTitle}"
                                class="sapUiSmallMarginBottom"
                            />
                        </Toolbar>

                        <Label
                            id="labelOnBehalfOf"
                            labelFor="inputOnBehalfOf"
                            text="{i18n>OnBehalfOfPerson}"
                            visible="{= (${initModel>/bIsOnBehalfOf})  &amp;&amp; !(${initModel>/bIsAnonymous}) }"
                        />
                        <Input
                            id="inputOnBehalfOf2"
                            value="{initModel>/sIncidentPersonOnBehalfOfIdCombined}"
                            valueHelpOnly="true"
                            showValueHelp="true"
                            valueHelpRequest="onValueHelpRequestForPersonOnBehalfOf"
                            placeholder="{i18n>SelectPerson}"
                            visible="{= (${initModel>/bIsOnBehalfOf})  &amp;&amp; !(${initModel>/bIsAnonymous}) }"
                        >
                            <layoutData>
                                <layout:GridData span="XL4 L4 M4 S12" />
                            </layoutData>
                        </Input>
                        <Button
                            id="btnCreatePersonOnBehalfOf"
                            press="onBtnCreatePersonOnBehalfOf"
                            type="Transparent"
                            text="{i18n>OnBehalfOfPersonCreate}"
                            visible="{= (${initModel>/bIsOnBehalfOf})  &amp;&amp; !(${initModel>/bIsAnonymous}) }"
                        >
                            <layoutData>
                                <layout:GridData span="XL3 L3 M3 S12" />
                            </layoutData>
                        </Button>
                        <List
                            items="{appView>/aIncidentPersonOnBehalfOf}"
                            mode="Delete"
                            backgroundDesign="Transparent"
                            showNoData="false"
                            visible="{= (${initModel>/bIsOnBehalfOf})  &amp;&amp; !(${initModel>/bIsAnonymous}) }"
                            delete="onBtnDeleteIncidentPersonOnBehalfOfPressed"
                        >
                            <DisplayListItem label="{appView>FullName}" />
                            <layoutData>
                                <layout:GridData
                                    indent="L2 M3 S0"
                                    linebreak="true"
                                    span="XL7 L7 M7 S12"
                                />
                            </layoutData>
                        </List>
                        <!-- Andre involverte , vitner mv -->
                        <Toolbar
                            style="Clear"
                            design="Solid"
                            ariaLabelledBy="titleInvolved,butGDPR"
                            class="sapUiLargeMarginBottom borderBottom sapUiLargeMarginEnd"
                            visible="{initModel>/bIsInvolved}"
                        >
                            <Title
                                id="titleInvolved"
                                text="{i18n>InvolvedTitle}"
                                class="sapUiSmallMarginBottom"
                            />
                        </Toolbar>

                        <Label
                            id="labelInvolved"
                            labelFor="inputInvolved"
                            text="{i18n>OnBehalfOfPerson}"
                            visible="{= (${initModel>/bIsInvolved})  &amp;&amp; !(${initModel>/bIsAnonymous}) }"
                        />
                        <Input
                            id="inputInvolved"
                            value="{initModel>/sIncidentPersonOnBehalfOfIdCombined}"
                            valueHelpOnly="true"
                            showValueHelp="true"
                            valueHelpRequest="onValueHelpRequestForPersonOnBehalfOf"
                            placeholder="{i18n>SelectPerson}"
                            visible="{= (${initModel>/bIsInvolved})  &amp;&amp; !(${initModel>/bIsAnonymous}) }"
                        >
                            <layoutData>
                                <layout:GridData span="XL4 L4 M4 S12" />
                            </layoutData>
                        </Input>
                        <Button
                            id="btnCreatePersonInvolved"
                            press="onBtnCreatePersonOnBehalfOf"
                            type="Transparent"
                            text="{i18n>OnBehalfOfPersonCreate}"
                            visible="{= (${initModel>/bIsInvolved})  &amp;&amp; !(${initModel>/bIsAnonymous}) }"
                        >
                            <layoutData>
                                <layout:GridData span="XL3 L3 M3 S12" />
                            </layoutData>
                        </Button>
                        <Label
                            id="labelInvolvedRole"
                            labelFor="selInvolvedRole"
                            text="{i18n>InvolvedRole}"
                            visible="{initModel>/bIsInvolved}"
                        />

                        <Select
                            id="selInvolvedRole"
                            visible="{initModel>/bIsInvolved}"
                        >
                            <core:Item text="Involvert" />
                            <core:Item text="Vitne" />
                            <core:Item text="Sjåfør" />
                            <core:Item text="Eier" />
                            <layoutData>
                                <layout:GridData span="XL4 L4 M4 S12" />
                            </layoutData>
                        </Select>
                        <List
                            items="{appView>/aIncidentPersonOnBehalfOf}"
                            mode="Delete"
                            backgroundDesign="Transparent"
                            showNoData="false"
                            visible="{= (${initModel>/bIsInvolved})  &amp;&amp; !(${initModel>/bIsAnonymous}) }"
                            delete="onBtnDeleteIncidentPersonOnBehalfOfPressed"
                        >
                            <DisplayListItem label="{appView>FullName}" />
                            <layoutData>
                                <layout:GridData
                                    indent="L2 M3 S0"
                                    linebreak="true"
                                    span="XL7 L7 M7 S12"
                                />
                            </layoutData>
                        </List>
                        <Toolbar
                            style="Clear"
                            design="Solid"
                            ariaLabelledBy="titlePersonInjurie"
                            class="borderBottom sapUiLargeMarginEnd"
                            visible="{initModel>/Personskade}"
                        >
                            <Title
                                id="titlePersonInjurie"
                                text="{i18n>PersonInjurie}"
                            />
                        </Toolbar>

                        <Toolbar
                            style="Clear"
                            design="Solid"
                            ariaLabelledBy="titlePersonInjurie"
                            class="borderBottom sapUiLargeMarginEnd"
                            visible="{initModel>/bIsMateriel}"
                        >
                            <Title text="{i18n>equipTitle}" />
                        </Toolbar>
                        <Label
                            text="{i18n>equip}"
                            visible="{initModel>/bIsMateriel}"
                        />
                        <Input
                            showValueHelp="true"
                            visible="{initModel>/bIsMateriel}"
                        />
                        <Button
                            visible="{initModel>/bIsMateriel}"
                            press="onBtnCreatePersonOnBehalfOf"
                            type="Ghost"
                            text="{i18n>equipSearch}"
                        >
                            <layoutData>
                                <layout:GridData span="XL3 L3 M3 S12" />
                            </layoutData>
                        </Button>
                        <Label
                            text="{i18n>equipDescrip}"
                            required="true"
                            visible="{initModel>/bIsMateriel}"
                        />
                        <Input visible="{initModel>/bIsMateriel}" />
                        <Label
                            text="{i18n>equipSerialNumber}"
                            visible="{initModel>/bIsMateriel}"
                        />
                        <Text visible="{initModel>/bIsMateriel}" />
                        <Label
                            text="{i18n>equipTechnical}"
                            visible="{initModel>/bIsMateriel}"
                        />
                        <Text visible="{initModel>/bIsMateriel}" />
                        <Label
                            text="{i18n>equipType}"
                            visible="{initModel>/bIsMateriel}"
                        />
                        <Text visible="{initModel>/bIsMateriel}" />
                        <Label
                            text="{i18n>equipMaterialNumber}"
                            visible="{initModel>/bIsMateriel}"
                        />
                        <Text visible="{initModel>/bIsMateriel}" />
                        <Label
                            text="{i18n>equipAdditionalInfo}"
                            visible="{initModel>/bIsMateriel}"
                        />
                        <TextArea
                            rows="3"
                            visible="{initModel>/bIsMateriel}"
                        />

                        <Toolbar
                            style="Clear"
                            design="Solid"
                            ariaLabelledBy="titleAttachment"
                            class="borderBottom sapUiLargeMarginEnd"
                        >
                            <Title
                                id="titleAttachment"
                                text="{i18n>Attachment}"
                            />
                        </Toolbar>
                    </f:content>
                </f:SimpleForm>
                <!-- Attachment Documents -->
                <!--&nbsp;
							We have to be a little creative in here. the incident is submitted and we can't add any documents after this happened. the
							reason is that the workflow, etc., may have already started and exclusively lock the incident/whistleblowing case created.
							so we have to send the attachment documents with the original payload of the incident data.
						-->
                <VBox class="sapUiSmallMarginBeginEnd">
                    <UploadCollection
                        noDataText="{i18n>AttachmentsNotUploadedYet}"
                        class="sapUiResponsiveMargin"
                        instantUpload="true"
                        items="{ path: 'appView>/aAttachmentDocument' }"
                        fileDeleted="onFileUploaderFileDeleted"
                        change="onFileUploaderChanged"
                        beforeUploadStarts="onBeforeUploadStarts"
                    >
                        <layoutData>
                            <layout:GridData
                                indent="L3 M3 S0"
                                span="L12 M7 S12"
                            />
                        </layoutData>

                        <toolbar>
                            <OverflowToolbar>
                                <ToolbarSpacer />
                                <unified:FileUploader
                                    id="btnFileUpload"
                                    buttonOnly="true"
                                    iconOnly="true"
                                    icon="sap-icon://add"
                                    change="onFileUploaderChanged"
                                    typeMissmatch="onFileUploaderTypeMissmatch"
                                    fileType="jpeg,png,jpg,pdf,msg"
                                />
                            </OverflowToolbar>
                        </toolbar>
                        <items>
                            <UploadCollectionItem
                                documentId="{appView>}"
                                fileName="{appView>sFileName}"
                                mimeType="{appView>sMimeType}"
                                visibleEdit="false"
                            />
                        </items>
                    </UploadCollection>
                </VBox>
            </VBox>
        </content>
        <footer>
            <Toolbar>
                <ToolbarSpacer />
                <Button
                    type="Ghost"
                    text="{i18n>Abort}"
                    press="onPressAbort"
                />
                <Button
                    type="Emphasized"
                    text="{i18n>Send}"
                    class="sapUiTinyMarginEnd"
                />
            </Toolbar>
        </footer>
    </Page>
</mvc:View>
